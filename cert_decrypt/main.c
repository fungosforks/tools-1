/*
 *   Program to encode text using RSA public key.
 *
 *   *** For Demonstration use only *****
 *
 *   Copyright (c) 1988-1997 Shamus Software Ltd.
 *
 *
 *   Decoding profile by Efim Bushmanov
 *
 *
 */


#include <stdio.h>

#include "include/miracl.h"
#include <stdlib.h>
#include <string.h>

int show_memory(char *mem, int len, char *text);


miracl *mip;

char user_pubkey[0x81];

///////////////////////
// needed for some operations
///////////////////////
char skype_pub[]=
"\xB8\x50\x6A\xEE\xD8\xED\x30\xFE\x1C\x0E\x67\x74\x87\x4B\x59\x20"
"\x6A\x77\x32\x90\x42\xA4\x9B\xE2\x40\x3D\xA4\x7D\x50\x05\x24\x41"
"\x06\x7F\x87\xBC\xD5\x7E\x65\x79\xB8\x3D\xF0\xBA\xDE\x2B\xEF\xF5"
"\xB5\xCD\x8D\x87\xE8\xB3\xED\xAC\x5F\x57\xFA\xBC\xCD\x49\x69\x59"
"\x74\xE2\xB5\xE5\xF0\x28\x7D\x6C\x19\xEC\xC3\x1B\x45\x04\xA9\xF8"
"\xBE\x25\xDA\x78\xFA\x4E\xF3\x45\xF9\x1D\x33\x9B\x73\xCC\x2D\x70"
"\xB3\x90\x4E\x11\xCA\x57\x0C\xE9\xB5\xDC\x4B\x08\xB3\xC4\x4B\x74"
"\xDC\x46\x35\x87\xEA\x63\x7E\xF4\x45\x6E\x61\x46\x2B\x72\x04\x2F"
"\xC2\xF4\xAD\x55\x10\xA9\x85\x0C\x06\xDC\x9A\x73\x74\x41\x2F\xCA"
"\xDD\xA9\x55\xBD\x98\x00\xF9\x75\x4C\xB3\xB8\xCC\x62\xD0\xE9\x8D"
"\x82\x82\x18\x09\x71\x05\x5B\x45\x7C\x06\xF3\x51\xE6\x11\x64\xFC"
"\x5A\x9D\xE9\xD8\x3D\x1D\x13\x78\x96\x40\x01\x38\x0B\x5B\x99\xEE"
"\x4C\x5C\x7D\x50\xAC\x24\x62\xA4\xB7\xEA\x34\xFD\x32\xD9\x0B\xD8"
"\xD4\xB4\x64\x10\x26\x36\x73\xF9\x00\xD1\xC6\x04\x70\x16\x5D\xF9"
"\xF3\xCB\x48\x01\x6A\xB8\xCA\x45\xCE\x68\x75\xA7\x1D\x97\x79\x15"
"\xCA\x82\x51\xB5\x02\x58\x74\x8D\xBC\x37\xFE\x33\x2E\xDC\x28\x55"
;
////////////////////////



/*

04-03: packet in 0x53 cmd -- send0003
(after 0x7D 0x7A commands)

*/


/*
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x58\xA2\x05\x15\x1D\x92\xE3\x21"
"\x7D\x0D\x7F\xCD\xFC\xEC\xCE\xB8\xFF\x32\x13\x3D\xAE\x03\x85\x79"
"\x10\xD2\x18\xA3\x42\x8D\x2A\x66\x10\x52\x48\x01\x98\x2D\x11\x15"
"\x64\xF9\x10\xB4\x21\xEF\xB3\x92\xC0\xC4\x08\xDE\x14\x74\xEA\x28"
"\xA7\x26\xDF\xF9\x9F\xF7\x10\x7D\x38\x68\xC7\xF8\xA3\xBA\x20\x71"
"\x83\xE1\xFE\x22\xE6\xEB\xF8\x38\xE3\x23\x0B\x57\x5F\x08\x13\x18"
"\xEA\xFB\xDD\x20\x37\x6E\xD7\x71\x4C\xA2\x3F\x8E\x4F\xA2\xB2\x0B"
"\x15\xC2\xC1\xC8\x30\xFC\x6F\x54\x32\x63\x64\x63\x0B\x2E\xCC\x59"
"\x30\x2E\x45\x2C\x60\x8B\x4C\x89\x33\xB7\x8C\x5E\x93\x14\x1F\xB3"
"\x4B\x5C\x2C\xC5\xC7\x34\x15\x93\x4A\xFE\x85\x78\xA7\xBF\x8F\xED"
"\x00\x37\x5C\x5E\x15\x69\xBC\xED\x2F\x62\xC0\xBF\x19\x8B\x33\xF8"
"\xB7\x0E\xE6\x04\xDF\x90\x7F\xC9\x48\x24\x57\x4E\xD1\x16\xF3\xF2"
"\x69\x2D\x39\xD6\xDE\xA4\x7E\xA4\xF4\xE5\xE5\x2F\x04\xF3\x9B\x54"
"\xFE\x14\x1D\x78\x87\x2D\xCE\x16\x3E\x7A\x7E\xA4\x2E\x3C\xCD\x3E"
"\x41\xAA\x6E\xC3\xDD\x26\x1B\x98\x64\x52\x11\xBE\xB1\x17\x4C\x0D"
"\x6D\x38\x4C\x3E\xE8\x6C\x12\x45\x80\x67\x85\x85\xC9\xA3\x80\x15"
"\xF1\x74\x18\x1B\x58\xE9\x45\x36\x0F\x52\x3E\xDE\xF2\xED\x73\x58"
"\xB0\x6C\xFA\xCB\x6C\xCC\x2C\x88\x49\x7E\x01\x05\x48\x48\xCA\x54"
"\xB8\x79\x0B\x9D\x19\x39\xCF\xB6\x86\xDA\xAD\xCB\x32\x2A\xF8\x37"
"\xC0\xCD\x4C\xCC\xCC\x57\xAD\xC1\x37\x2F\x19\xED\x37\xA1\x43\x62"
"\xB0\x5C\xF0\x25\xA3\x75\xFD\xB9\xDD\x5C\xA6\xEE\x60\x81\xC6\x6A"
"\x42\x50\xC4\xF2\xA5\xC8\x75\xE4\x71\xF4\x64\x69\x57\x30\xF7\x57"
"\x98\x10\x4C\x45\x30\x85\x54\x2E\xD3\x91\x8B\x51\xF6\x57\x9B\x7D"
"\x72\xA1\xEA\x5E\x4E\x70\x87\xD4\x49\xC0\x26\xFD\xAD\xC5\x63\xA5"
"\xC5\xA2\x33\xCA\x83\x16\x8C\xF7"
;

*/


/*
in reply in last 57 41.

04-11:

*/

/*
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x1C\x67\x0C\x65\xBA\xD0\x3E\xDA"
"\xDE\x9F\x3A\x59\x63\xE9\xDF\x49\x50\x9F\xB7\x4B\x4F\x87\x2B\xAE"
"\xAE\x1F\xFD\x53\xF3\x28\x33\x60\x6D\x13\xE1\x9E\x6B\x7F\x07\x33"
"\xB1\x8D\x81\x96\xC1\xF2\x28\x01\xD6\xAF\x27\x09\xA4\x35\xA6\x6A"
"\x49\xE6\x66\x87\xAD\x16\xEE\xB1\x65\x8C\x0C\x8E\x1B\xEA\xD9\x7F"
"\x6A\x4B\xC3\xD5\x50\x9F\x27\xE3\xC8\xCF\xDE\x81\x3B\xB9\x5A\xD1"
"\x23\x49\x37\xB7\xAA\xDF\x18\x27\x30\x70\x3C\x2A\xEF\xF8\xA8\x7A"
"\x57\x6D\xC9\x1A\x1E\x45\x72\xBF\x2A\xC7\x37\xCB\x15\x68\xAF\xEE"
"\x84\x6B\x8C\x02\xA2\x21\x8F\xAD\x43\x9F\xF3\x62\xE3\x08\x09\xFB"
"\x08\xD7\xC9\x42\x55\x7F\x7B\xD7\xD7\xB2\xDB\x02\x62\x6A\x7F\xB7"
"\x9D\x8D\x83\x46\xCB\xDF\xB4\x68\xE5\x26\x2A\x34\x5E\x39\xC2\x5F"
"\x65\x00\x57\x1C\x3D\xB7\x7F\xA5\x18\xC5\xF3\xD7\x92\x56\xFB\x6D"
"\x7B\x47\x0F\xC8\xE9\xCB\x5B\x35\x54\xC6\x8A\x23\x31\x13\x63\xDF"
"\x6E\x78\xDD\x57\xA5\x49\x9E\x31\x79\xCD\xD8\xE2\xD9\xE6\x9C\x17"
"\x4F\xB0\x90\xE0\x71\x33\x22\x9E\x04\xD4\x70\x89\xE9\x66\x9B\x8C"
"\x28\x5E\xCD\xA0\xCC\x4C\x01\x03\x02\x6C\xF4\xB1\xE8\xF0\x96\xF6"
"\xC4\x85\x74\xAE\x06\xB4\xDE\xDB\x75\x50\x73\x4E\x76\xE9\x8C\xE3"
"\x4C\x1B\xCA\x7A\x38\x2A\xFE\x04\xF8\x62\xB4\xE2\x62\xD5\x42\x10"
"\x14\x2A\x7D\xF4\x70\xAA\xD5\x43\x60\x12\x9C\x8A\x4B\x63\x33\x5F"
"\xAA\x1A\xC5\x1F\xE7\x5B\xB0\x16\x3C\x1E\x16\xC0\x72\x48\x14\x82"
"\x39\x48\xD6\x85\xBF\xB6\xFD\x88\x22\x5F\x50\xD1\x22\xC0\x59\xEF"
"\x6C\x68\xAD\xB0\x4B\xC1\xFA\x20\xE1\x76\xE8\xAC\x04\x62\x5B\x75"
"\x64\x13\xC8\xC9\xDF\xB8\xCF\x9B\xD1\xC6\xB4\x10\xB8\x28\xA0\x8F"
"\x20\x9F\xD3\xE5\x4B\xD4\x55\x57\x77\x56\xAE\x7E\xEE\x9F\x7D\x2D"
"\xA5\xF5\xDF\xFF\xEB\xA1\xA1\xD8"
;
*/

/*
// 45 41  04-11: orig

char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x5A\x49\xCF\x45\xA3\xA4\xA4\x41"
"\x0E\x1D\x85\x84\xE4\x96\x35\xE2\x7B\x60\xD4\xD4\x17\x75\xC0\xCE"
"\xAF\x59\xB2\x75\xDC\x67\x03\xF0\x3A\x07\xED\xD1\x41\x66\x4A\xD0"
"\x4A\x1F\xBE\x65\x80\x77\xE0\xA9\x28\x62\x4C\xE9\x74\x6A\xD9\x5F"
"\xBE\x6F\x5E\xBF\x8D\xBF\x3E\x97\x67\x76\xBF\x48\x25\xF9\x8A\x06"
"\x06\xF5\xB5\x80\x54\xE6\x55\x7D\x3C\x6E\xD2\xBC\xAE\x04\xC4\x6C"
"\x18\x32\xBF\x53\x2E\x02\xDE\x7B\x1A\xA5\x99\xE8\x30\x7D\x13\x65"
"\xD4\xE1\xE3\xDA\x69\x8F\x72\xA6\x78\xA2\x22\x85\x20\x6D\x89\xFF"
"\x2D\x2F\x55\xB7\xC0\x00\x4A\xA7\xCF\xE8\xAF\x06\x29\xDB\x86\x69"
"\x5E\xCE\x1C\x6B\x44\xE6\x3D\xAA\x4D\x1A\x8F\xC7\x97\x96\x4B\x54"
"\x95\xE9\x42\x5A\x2C\x70\x58\x51\x9B\xD7\x2F\x66\x40\x06\x22\x09"
"\xFE\x05\x88\xA4\x93\xD0\xE9\x75\x29\xBC\xC3\xED\x84\x4A\x9C\x67"
"\x6D\xFD\xF3\x30\x74\x2A\x5A\x6A\x9A\xDA\x09\x54\x90\xF8\x89\x70"
"\xF5\xAC\x94\x70\x05\x04\xBE\xF3\xCF\xAD\x4D\x49\xFC\x85\x94\x1E"
"\xC1\x3B\x3B\x15\xAB\x7F\x29\x4C\x68\xFA\x37\x0A\xD7\xA2\x43\x23"
"\x08\x9F\x49\xB6\xBE\x2F\x0C\x25\xF5\x89\x2A\x4D\x3C\x5D\x78\x98"
"\xD3\x7C\x2C\x70\x2A\x9D\x12\x32\xB8\x57\x14\x7E\x4E\xD2\x92\x32"
"\x52\xFE\x11\xFF\x92\xB9\x3F\x0B\x7B\x80\x91\x7F\x51\x24\xA0\xD4"
"\xE1\x4F\xFE\x51\xC3\xBF\x5C\xC0\xE2\x0C\xED\x7E\x1E\x3A\x02\x24"
"\x05\xD6\xE3\x6D\x54\x8F\x4E\x46\x92\x84\x02\x68\x27\x33\x88\xBD"
"\x57\xE7\xD8\x32\xED\x5F\xE7\x1D\x8E\x98\x11\xDF\xFD\x52\xA2\x4E"
"\xE5\xD2\xEB\x1B\x93\xD5\x9A\x17\x05\x9A\xAE\x20\x57\x32\x73\xFB"
"\x77\xE7\xEC\x1F\x90\xEB\x7A\x3A\x49\xF7\x12\x01\x43\x7A\x11\x32"
"\xFA\xDE\x8F\x26\x28\xA0\xB0\x0C\x82\xFA\x0F\x0B\x2D\xAE\x51\xB1"
"\x43\xE1\x37\x0F\xC2\x00\xF2\xD3"
;

*/


/* 

//
// 45 41  04-11: my
// (broken!)
//

char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x77\x9E\x0F\xA9\x19\xE7\xFD\x5A"
"\x43\x87\x44\x0A\x7B\x9D\x27\xE3\x3D\xCE\xF5\xEA\x3C\xEB\x5C\x2C"
"\x3A\xD2\x80\x84\x73\x59\x60\x91\x1F\x1E\xBF\xE5\x94\x4D\x9B\xA0"
"\xED\xB9\xE9\xB6\xB8\xFC\xA5\x20\x4A\xBA\xC5\x55\x82\xA4\x32\x0C"
"\x1E\xD8\x50\xDE\xFD\x53\x8B\x38\xB8\x9B\x94\xD5\x95\xFF\x75\x7B"
"\x9D\x7C\x32\x85\xDA\x85\x15\x4D\x4D\x5F\x0A\x45\xCC\xDC\x3B\x2F"
"\xA9\x69\x6A\xD5\xE8\x35\xC0\xAC\x69\xB7\x28\x93\xA1\x58\x95\xD5"
"\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA\xAA"
"\x7C\x7B\x10\xD1\xD6\xFE\x38\x6E\x02\xA9\x94\xE0\xF0\xF6\x7B\x65"
"\xCF\x2F\x7F\x9B\x59\x5A\x3D\xCE\x11\x85\x0F\x46\xB3\x79\x52\x59"
"\x45\xF2\x68\x08\xF0\x67\x16\x7F\x8A\xE5\x08\x4A\x4A\xC0\xBD\xB2"
"\x7C\x0B\xF3\x90\x9D\xC1\x67\xB8\x68\xBA\x6C\x6B\x56\x69\xFD\xA6"
"\xAF\x93\x24\xAA\x5C\x83\x22\x87\x22\x8E\xD6\xFA\x24\xBA\x89\xAA"
"\xBA\x1E\x92\xE8\xDA\x00\x01\x9D\xC6\xEC\x4D\x51\x0E\xC2\xAD\x09"
"\xAB\x73\x1F\xFF\xFE\x4B\x74\xA4\x87\x19\xF7\x03\xA5\x2C\xBA\x64"
"\x8D\x28\x12\x7D\x41\xBF\x82\xEE\x3C\xF1\x6C\x20\x18\xBC\xA4\x23"
"\x5E\x99\x69\x0C\x13\x7D\x69\xB8\x33\x94\xCC\x02\x4B\xA0\x83\xA3"
"\x00\xBC\x7A\x7C\x11\x85\xBA\x7A\xF1\x2E\x8A\xA6\x20\x62\x6D\x08"
"\x8B\xDD\x75\x92\x50\x15\xB5\xD1\x13\xCE\x2A\xB3\xB8\x1B\x7B\xE2"
"\xD0\x8F\x1E\xF7\xEB\x23\xEC\x76\x51\xBB\x97\x04\x9F\xA3\x45\x49"
"\x54\x69\xF8\x6C\x0E\x21\x13\x75\xD2\x49\x40\x4E\x08\x30\x0E\xCF"
"\xF4\xF1\x0A\x56\xD0\x8F\x31\x0A\x43\xFD\xA0\x83\xD8\x4D\x04\x0F"
"\x4B\xBC\x92\xC5\xBA\x26\xBF\xDB\xFB\xA3\xB1\x67\x63\x05\x1C\xF1"
"\x63\x6A\xA6\x7E\x40\x0F\x28\xD1\xAB\xBE\x49\xC3\x52\xAC\x23\x9D"
"\x9F\x80\xA3\x50\x58\xD5\xC1\xFE"
;
*/


/*
//
// my send 45 41 blob 04-05 hmmm
//

char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x58\xA2\x05\x15\x1D\x92\xE3\x21"
"\x7D\x0D\x7F\xCD\xFC\xEC\xCE\xB8\xFF\x32\x13\x3D\xAE\x03\x85\x79"
"\x10\xD2\x18\xA3\x42\x8D\x2A\x66\x10\x52\x48\x01\x98\x2D\x11\x15"
"\x64\xF9\x10\xB4\x21\xEF\xB3\x92\xC0\xC4\x08\xDE\x14\x74\xEA\x28"
"\xA7\x26\xDF\xF9\x9F\xF7\x10\x7D\x38\x68\xC7\xF8\xA3\xBA\x20\x71"
"\x83\xE1\xFE\x22\xE6\xEB\xF8\x38\xE3\x23\x0B\x57\x5F\x08\x13\x18"
"\xEA\xFB\xDD\x20\x37\x6E\xD7\x71\x4C\xA2\x3F\x8E\x4F\xA2\xB2\x0B"
"\x15\xC2\xC1\xC8\x30\xFC\x6F\x54\x32\x63\x64\x63\x0B\x2E\xCC\x59"
"\x30\x2E\x45\x2C\x60\x8B\x4C\x89\x33\xB7\x8C\x5E\x93\x14\x1F\xB3"
"\x4B\x5C\x2C\xC5\xC7\x34\x15\x93\x4A\xFE\x85\x78\xA7\xBF\x8F\xED"
"\x00\x37\x5C\x5E\x15\x69\xBC\xED\x2F\x62\xC0\xBF\x19\x8B\x33\xF8"
"\xB7\x0E\xE6\x04\xDF\x90\x7F\xC9\x48\x24\x57\x4E\xD1\x16\xF3\xF2"
"\x69\x2D\x39\xD6\xDE\xA4\x7E\xA4\xF4\xE5\xE5\x2F\x04\xF3\x9B\x54"
"\xFE\x14\x1D\x78\x87\x2D\xCE\x16\x3E\x7A\x7E\xA4\x2E\x3C\xCD\x3E"
"\x41\xAA\x6E\xC3\xDD\x26\x1B\x98\x64\x52\x11\xBE\xB1\x17\x4C\x0D"
"\x6D\x38\x4C\x3E\xE8\x6C\x12\x45\x80\x67\x85\x85\xC9\xA3\x80\x15"
"\xF1\x74\x18\x1B\x58\xE9\x45\x36\x0F\x52\x3E\xDE\xF2\xED\x73\x58"
"\xB0\x6C\xFA\xCB\x6C\xCC\x2C\x88\x49\x7E\x01\x05\x48\x48\xCA\x54"
"\xB8\x79\x0B\x9D\x19\x39\xCF\xB6\x86\xDA\xAD\xCB\x32\x2A\xF8\x37"
"\xC0\xCD\x4C\xCC\xCC\x57\xAD\xC1\x37\x2F\x19\xED\x37\xA1\x43\x62"
"\xB0\x5C\xF0\x25\xA3\x75\xFD\xB9\xDD\x5C\xA6\xEE\x60\x81\xC6\x6A"
"\x42\x50\xC4\xF2\xA5\xC8\x75\xE4\x71\xF4\x64\x69\x57\x30\xF7\x57"
"\x98\x10\x4C\x45\x30\x85\x54\x2E\xD3\x91\x8B\x51\xF6\x57\x9B\x7D"
"\x72\xA1\xEA\x5E\x4E\x70\x87\xD4\x49\xC0\x26\xFD\xAD\xC5\x63\xA5"
"\xC5\xA2\x33\xCA\x83\x16\x8C\xF7"
;


*/

//
// remote credentials 4_5
//

/*
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x94\x8E\xD8\xA1\x58\x6D\x7A\x36"
"\x15\xC8\xFA\x6C\xEA\x81\x44\x92\x3D\xD8\xC6\x82\xB2\x35\x7C\x8E"
"\x7A\x73\x3F\xC5\x90\xB6\xAD\xEF\xAE\x9B\x89\x20\xD5\xFF\x6F\x68"
"\xB3\xAC\xDA\x10\x0B\xB0\x2B\x45\xEA\x60\x77\x8D\x98\x3E\x25\x64"
"\xF6\x01\x79\xA8\xDA\x97\x9D\xB6\x54\x49\x15\xA7\xA1\x32\x40\x96"
"\x5A\xC4\x8D\x6E\x9A\x0C\x40\x84\xAB\xE2\x1F\x61\xE5\x9A\x65\x5B"
"\x32\x85\x9A\x03\x5C\xBF\x33\x16\xD2\xEB\x14\xB6\xB3\x8D\xDC\x1A"
"\x73\xA0\xAC\x0C\xB8\x4C\xE0\x8C\x49\xEE\x55\x88\xD1\xDA\x38\x69"
"\x05\x3D\xBA\x12\x77\x6F\x26\xBA\x6F\x16\x70\x95\xFD\x02\x19\xE3"
"\x99\xA5\x7C\x91\x5F\xD4\xE6\x45\x55\x88\x79\x8A\x30\x40\xD9\x9A"
"\x15\xE8\x00\xC8\xEA\x49\x54\xC0\xC0\xB5\x34\xE0\x78\x10\x45\x91"
"\x90\x10\xD2\x1A\x04\x91\xF7\x45\x55\xA3\x9D\xD8\x6C\xA7\xA0\x59"
"\xEF\x3F\x5C\x8C\x36\x19\xC0\x90\xC7\x3A\x53\x78\x89\xA0\x4F\xAB"
"\x9B\x73\xCC\x01\xB4\x29\xBC\x4C\x9E\xCF\x47\x0D\xFB\xA8\xB8\x47"
"\x9B\x3F\x74\xAC\xA6\x7D\xFF\xE3\xD9\x4E\xFB\x0D\xB1\x1C\xAF\x5A"
"\xB8\xDC\xF1\x0B\xEB\x0A\x40\x70\x87\x51\x78\xE1\x7D\xF6\x79\x8B"
"\x20\x52\x8B\xCF\xDA\x60\x36\x58\x42\xD1\x14\x5C\x6F\x17\xF2\x33"
"\xF3\x2F\x81\x89\x9C\x56\x4C\xBD\xF8\xBF\x61\x2D\x4E\xDA\xDF\x19"
"\xC8\x95\x38\xD2\xAD\x5D\x9B\x6F\x32\xBF\x8C\x0E\x7D\x81\x79\x95"
"\xC0\xDE\x0B\x58\x5F\x95\x0C\x32\xE4\xA4\xE7\x80\xAA\x5D\xE2\xF7"
"\xAA\xBB\x44\x9C\x40\x00\x4F\x19\x16\x2F\x0C\x2C\x71\x9D\x61\xB0"
"\x54\x5E\x20\x5D\x9E\xBD\x7E\x75\x36\x26\xF0\xD4\x44\x3D\x60\xA3"
"\x10\x8A\x61\xBD\xFF\x00\x18\x3B\x61\x8C\xB5\x9D\x2F\x94\x31\x76"
"\xAE\x7D\x80\x27\x10\xEB\x84\xF6\x8B\xDB\x4E\x9C\x8A\x96\x5C\xB1"
"\xB3\x86\x33\xB1\x34\xC4\x57\x39"
;

*/

/*
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x94\x8E\xD8\xA1\x58\x6D\x7A\x36"
"\x15\xC8\xFA\x6C\xEA\x81\x44\x92\x3D\xD8\xC6\x82\xB2\x35\x7C\x8E"
"\x7A\x73\x3F\xC5\x90\xB6\xAD\xEF\xAE\x9B\x89\x20\xD5\xFF\x6F\x68"
"\xB3\xAC\xDA\x10\x0B\xB0\x2B\x45\xEA\x60\x77\x8D\x98\x3E\x25\x64"
"\xF6\x01\x79\xA8\xDA\x97\x9D\xB6\x54\x49\x15\xA7\xA1\x32\x40\x96"
"\x5A\xC4\x8D\x6E\x9A\x0C\x40\x84\xAB\xE2\x1F\x61\xE5\x9A\x65\x5B"
"\x32\x85\x9A\x03\x5C\xBF\x33\x16\xD2\xEB\x14\xB6\xB3\x8D\xDC\x1A"
"\x73\xA0\xAC\x0C\xB8\x4C\xE0\x8C\x49\xEE\x55\x88\xD1\xDA\x38\x69"
"\x05\x3D\xBA\x12\x77\x6F\x26\xBA\x6F\x16\x70\x95\xFD\x02\x19\xE3"
"\x99\xA5\x7C\x91\x5F\xD4\xE6\x45\x55\x88\x79\x8A\x30\x40\xD9\x9A"
"\x15\xE8\x00\xC8\xEA\x49\x54\xC0\xC0\xB5\x34\xE0\x78\x10\x45\x91"
"\x90\x10\xD2\x1A\x04\x91\xF7\x45\x55\xA3\x9D\xD8\x6C\xA7\xA0\x59"
"\xEF\x3F\x5C\x8C\x36\x19\xC0\x90\xC7\x3A\x53\x78\x89\xA0\x4F\xAB"
"\x9B\x73\xCC\x01\xB4\x29\xBC\x4C\x9E\xCF\x47\x0D\xFB\xA8\xB8\x47"
"\x9B\x3F\x74\xAC\xA6\x7D\xFF\xE3\xD9\x4E\xFB\x0D\xB1\x1C\xAF\x5A"
"\xB8\xDC\xF1\x0B\xEB\x0A\x40\x70\x87\x51\x78\xE1\x7D\xF6\x79\x8B"
"\x20\x52\x8B\xCF\xDA\x60\x36\x58\x5E\x1D\x40\x4A\x21\x65\x25\xF5"
"\x1C\x5A\xBE\xD2\xAA\x37\x8A\xD6\x48\x1C\x0C\x96\x3D\x92\x33\xF1"
"\xA8\x6D\x31\x35\x28\xB0\xE4\x80\xD7\x79\x2A\x4C\xB3\x97\x63\x53"
"\x72\x6B\x61\x4C\xF1\x96\xD8\x9A\x24\xF5\x54\x4A\xC5\xA0\x2C\x4C"
"\x7A\xE4\x78\xE2\xB9\xB2\x22\x5B\xFF\x08\x8E\xB5\x16\x59\xB0\x17"
"\xC1\xE6\x0B\x44\x92\xF8\xF6\xDA\x83\x6B\xC0\x03\xE4\x1D\x76\xFF"
"\x6A\xBC\x3D\x30\xB0\x1D\x47\x09\xD8\x20\x55\x79\xAD\x40\x7C\x37"
"\x0C\x5F\x30\xAE\x54\x05\xE9\x3D\xE4\x2D\x5E\xE1\x89\xA9\x61\xDA"
"\xA0\xFD\x89\xF1\x1B\x36\xFF\x9A"
;

*/

/*
// 57 41 my
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x2F\x6D\xD9\x6F\x82\x05\x6A\x8C"
"\x68\x64\x49\x3F\x5E\xC4\xB5\x6E\xBD\x60\xE3\xDB\xB8\x22\x57\x8F"
"\x30\xB7\x8A\x84\x5D\x8E\xD3\x19\x27\xC5\x05\x4C\xE0\xAC\x4E\xA1"
"\x2B\x98\xC4\x84\xDF\x8C\xAD\x90\x96\x42\xEB\xAB\x1E\x3E\xFC\x50"
"\xDC\xA6\xA4\x20\x8E\x38\x0F\xE5\xFD\x5B\x95\x73\x92\x57\x8A\xD7"
"\x0C\xC5\x3B\xDC\x5D\x22\x12\x1B\xDD\x91\xFE\xEB\x30\xF1\x82\xAF"
"\xCE\x94\x5A\xC6\x36\x84\x71\x8F\x94\xDA\x16\xE0\xA8\xB3\x44\x19"
"\xEC\x1F\x6A\x2E\x9B\x57\x74\x30\x3C\x3B\x10\x64\x2E\x7C\x52\x0C"
"\x73\x13\x2A\x6D\xBB\x54\xB9\x9A\x5A\xFF\x8C\x4E\x22\xEB\xF6\x29"
"\x27\xCE\x0A\x5F\x6E\x57\x34\x15\x86\x79\x41\xAC\xBF\xEA\xBD\x07"
"\x1A\xF1\x41\x30\x21\x74\xA4\x2A\x13\x4A\xF7\x64\x0C\xA2\x0E\x92"
"\x73\x99\x59\xC7\x56\x76\x88\x6E\xCB\x62\x78\x54\xAB\x64\xA5\x6E"
"\x45\x0D\x0B\x7E\x24\x9F\xD7\xF6\x9E\x2E\x1C\x8F\x80\x40\x2F\xB0"
"\x60\x25\xDC\x4E\x07\xEA\x94\x98\xA6\xAD\x14\x27\x59\x7C\x98\xA7"
"\xDE\xAA\x86\xB2\x20\x71\x4C\x79\x44\x34\x51\xDD\x83\xDB\xB4\x31"
"\x17\x9D\x49\x54\x38\x78\x3B\x83\x83\xA5\x3F\x0F\x76\x24\xAC\xB1"
"\x17\x70\xBD\xD4\xC9\x64\x47\x04\x4F\x67\x79\xC8\x61\x0B\x86\xC3"
"\x8D\xBB\x2D\xD1\xDB\x01\xDB\xAA\x14\xD1\x19\xD2\x9B\x4C\x04\x95"
"\x96\x6C\xAF\x33\x1E\x9F\x71\x0B\x7B\x40\xB4\xC4\x79\x20\xFF\x3D"
"\x39\x96\x07\xC9\x4B\xE9\xA2\x0B\x29\xB8\xE4\x0C\x64\x03\xE6\x8A"
"\xEB\xDB\xCD\xA1\x3C\xA9\xA0\xFF\x64\x65\x45\xD1\x9A\x8B\xC1\xA7"
"\xF3\x33\x75\x1E\x59\x05\xF4\x3A\xF2\x61\x9F\xC6\x79\xAD\xD1\x19"
"\x7A\xF7\x06\x73\xC3\xA7\x8B\x10\x5F\x09\x26\x77\x5F\x3C\xE2\x2C"
"\x3B\xFC\x53\xC4\xAA\x45\x72\x94\xC9\x54\x47\x9E\x69\xA3\x0D\xE6"
"\xC8\x25\x60\x49\x4B\x7E\x8D\x3C"
;
*/

/*
// my new test
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x58\xA2\x05\x15\x1D\x92\xE3\x21"
"\x7D\x0D\x7F\xCD\xFC\xEC\xCE\xB8\xFF\x32\x13\x3D\xAE\x03\x85\x79"
"\x10\xD2\x18\xA3\x42\x8D\x2A\x66\x10\x52\x48\x01\x98\x2D\x11\x15"
"\x64\xF9\x10\xB4\x21\xEF\xB3\x92\xC0\xC4\x08\xDE\x14\x74\xEA\x28"
"\xA7\x26\xDF\xF9\x9F\xF7\x10\x7D\x38\x68\xC7\xF8\xA3\xBA\x20\x71"
"\x83\xE1\xFE\x22\xE6\xEB\xF8\x38\xE3\x23\x0B\x57\x5F\x08\x13\x18"
"\xEA\xFB\xDD\x20\x37\x6E\xD7\x71\x4C\xA2\x3F\x8E\x4F\xA2\xB2\x0B"
"\x15\xC2\xC1\xC8\x30\xFC\x6F\x54\x32\x63\x64\x63\x0B\x2E\xCC\x59"
"\x30\x2E\x45\x2C\x60\x8B\x4C\x89\x33\xB7\x8C\x5E\x93\x14\x1F\xB3"
"\x4B\x5C\x2C\xC5\xC7\x34\x15\x93\x4A\xFE\x85\x78\xA7\xBF\x8F\xED"
"\x00\x37\x5C\x5E\x15\x69\xBC\xED\x2F\x62\xC0\xBF\x19\x8B\x33\xF8"
"\xB7\x0E\xE6\x04\xDF\x90\x7F\xC9\x48\x24\x57\x4E\xD1\x16\xF3\xF2"
"\x69\x2D\x39\xD6\xDE\xA4\x7E\xA4\xF4\xE5\xE5\x2F\x04\xF3\x9B\x54"
"\xFE\x14\x1D\x78\x87\x2D\xCE\x16\x3E\x7A\x7E\xA4\x2E\x3C\xCD\x3E"
"\x41\xAA\x6E\xC3\xDD\x26\x1B\x98\x64\x52\x11\xBE\xB1\x17\x4C\x0D"
"\x6D\x38\x4C\x3E\xE8\x6C\x12\x45\x80\x67\x85\x85\xC9\xA3\x80\x15"
"\xF1\x74\x18\x1B\x58\xE9\x45\x36\x8C\x5A\xCE\x72\x45\xF4\x47\x7B"
"\x2A\xFD\xBF\xAF\x23\x2A\x6F\xBA\x41\xD9\x2B\x60\x39\x82\x0C\xB9"
"\x1B\x20\x7E\x8F\x5E\x1A\x33\x43\x02\xE0\xB1\xDE\x0E\x3F\x7E\x05"
"\xF4\xFD\x32\xDE\xD0\x44\x17\xC0\x8E\x9F\x22\xF6\x43\xE0\x00\xC1"
"\xD4\x10\x2E\x12\x4E\x60\xC9\xD6\x17\x88\xBC\xC7\x0F\x7C\xC7\x8B"
"\xA5\x38\x2F\xEC\x46\xF9\x1F\x8E\xFD\x2B\x51\xE2\xAB\x34\xE9\x6C"
"\x75\x3F\x3E\x53\x2F\x00\xA0\x59\x60\xD7\x0E\x01\x45\xC5\x3C\xDF"
"\x5E\x22\x66\x8F\x27\xA3\x56\x88\x24\xB2\x85\xD8\xD3\xC2\xFD\x7A"
"\x08\x37\xDE\xB6\xBC\xAC\xB4\x93"
;

*/

/*

//
// 45 41 from log wiki
// blob 04-05 data
//
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\xAA\x10\x16\xDC\xB4\x7D\xD2\x62"
"\xE0\x2D\xE1\x25\x35\xB8\x10\x8D\x5D\x66\x20\x2C\x3C\x74\x9E\x6F"
"\x3B\x52\xE7\x56\xFC\x30\xF8\x15\xED\x5E\x28\x9E\x00\xF5\x5F\xE3"
"\xC2\x60\xF3\xAF\xFC\x5D\x78\x51\xA8\xA0\x9A\x52\x16\x15\xF7\x0C"
"\x5E\x3A\xCD\xE5\x17\xFD\xF0\xC5\x8F\xD9\xA3\xBA\xB6\xD1\x69\xDF"
"\x95\x43\xBD\xD0\x6A\x9C\x17\xF4\x5C\x66\x9A\x90\x86\x0D\x8C\xB8"
"\x83\x2D\x5C\xDD\x20\xE0\xC1\x28\xBB\x48\x93\x4C\x8B\x77\xC9\x79"
"\x9A\x66\x97\x10\xCE\xAE\x72\xCA\x7C\x1C\xB0\xBB\xC4\x39\x0C\x67"
"\xCD\x32\x42\xF1\x11\x1B\x98\xF8\x14\xF2\x1A\x2E\x14\x4C\x9A\x9B"
"\x4E\x0B\x4C\xCF\xAD\xC2\x44\x98\x55\x8F\x59\x5D\xD2\xC9\xE3\x62"
"\x06\xE0\x58\x94\x91\xE0\x21\x5B\x15\x4D\x57\x29\xF6\x6F\xE2\xC5"
"\x79\xAC\x1A\x8E\x23\xCD\xA2\x82\x3B\xB6\x20\x39\x9E\xE6\xB4\xE5"
"\x65\xF0\xEA\xB4\x37\x6F\xBC\xDD\xC3\xD4\xF0\xD5\x01\x45\x5A\xB8"
"\x9A\x98\xA3\x81\x26\x56\xB6\x32\x6B\x37\xCC\x22\x64\x47\x17\x9B"
"\x00\x86\x6B\xE9\xC8\x25\x05\xAB\x81\xDD\xFC\x2B\x06\x1C\x88\xDC"
"\xF7\x5E\x94\xDA\xA7\xBB\x4E\xFC\xE6\xB0\xDF\x88\xB6\x8F\xC6\x9C"
"\x8E\xAC\x7D\x6F\x41\x69\x0C\x48\x3C\xCF\x4F\xAC\x46\x8A\x1A\xCF"
"\x4C\x54\xF1\xDE\xB1\x15\xAB\xA3\x08\xE2\x6C\x3C\x7A\xE8\x11\xB6"
"\xFA\x10\x49\x86\x16\x43\x17\x17\x98\x2C\x8B\x93\x9B\x52\x08\x97"
"\xF0\x8A\xDA\x1B\x2A\xB7\x1B\xA9\xAA\xBF\x73\x31\xE3\xA0\x8A\xAB"
"\x10\xD4\x55\xA2\xA8\x67\x48\x82\x0D\xF9\xB0\x51\x67\x3F\x5B\x72"
"\x6F\x69\xB2\xA4\x5D\x8F\x33\x4C\x3F\x57\x4F\x77\xB7\xF5\xB4\x18"
"\x06\x74\x96\xA6\x7F\xC2\xB9\xD7\xF7\x7D\x7C\x23\x16\x61\xC5\x38"
"\x31\xED\x37\xDA\x58\xFD\x53\x33\x07\x13\x6D\x94\x2E\xE2\x5D\x2F"
"\x0A\x66\x57\x0F\xCC\x7E\x04\x64"
;

*/


/*
//
// 44 41 04-05: reply to me from orig skype55
//
char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x94\x8E\xD8\xA1\x58\x6D\x7A\x36"
"\x15\xC8\xFA\x6C\xEA\x81\x44\x92\x3D\xD8\xC6\x82\xB2\x35\x7C\x8E"
"\x7A\x73\x3F\xC5\x90\xB6\xAD\xEF\xAE\x9B\x89\x20\xD5\xFF\x6F\x68"
"\xB3\xAC\xDA\x10\x0B\xB0\x2B\x45\xEA\x60\x77\x8D\x98\x3E\x25\x64"
"\xF6\x01\x79\xA8\xDA\x97\x9D\xB6\x54\x49\x15\xA7\xA1\x32\x40\x96"
"\x5A\xC4\x8D\x6E\x9A\x0C\x40\x84\xAB\xE2\x1F\x61\xE5\x9A\x65\x5B"
"\x32\x85\x9A\x03\x5C\xBF\x33\x16\xD2\xEB\x14\xB6\xB3\x8D\xDC\x1A"
"\x73\xA0\xAC\x0C\xB8\x4C\xE0\x8C\x49\xEE\x55\x88\xD1\xDA\x38\x69"
"\x05\x3D\xBA\x12\x77\x6F\x26\xBA\x6F\x16\x70\x95\xFD\x02\x19\xE3"
"\x99\xA5\x7C\x91\x5F\xD4\xE6\x45\x55\x88\x79\x8A\x30\x40\xD9\x9A"
"\x15\xE8\x00\xC8\xEA\x49\x54\xC0\xC0\xB5\x34\xE0\x78\x10\x45\x91"
"\x90\x10\xD2\x1A\x04\x91\xF7\x45\x55\xA3\x9D\xD8\x6C\xA7\xA0\x59"
"\xEF\x3F\x5C\x8C\x36\x19\xC0\x90\xC7\x3A\x53\x78\x89\xA0\x4F\xAB"
"\x9B\x73\xCC\x01\xB4\x29\xBC\x4C\x9E\xCF\x47\x0D\xFB\xA8\xB8\x47"
"\x9B\x3F\x74\xAC\xA6\x7D\xFF\xE3\xD9\x4E\xFB\x0D\xB1\x1C\xAF\x5A"
"\xB8\xDC\xF1\x0B\xEB\x0A\x40\x70\x87\x51\x78\xE1\x7D\xF6\x79\x8B"
"\x20\x52\x8B\xCF\xDA\x60\x36\x58\xA1\x1D\x4A\x34\xFF\x21\xFD\xDE"
"\xEB\xA0\x57\x29\xD0\xA5\xCF\xA3\x08\xC0\x38\xAC\x3C\x97\x85\xFC"
"\x6B\x56\x8C\x27\x9E\x54\x6A\xD2\xC1\x26\x33\x90\x10\x06\xEF\xF3"
"\xFD\x15\xB1\xF2\x4F\xC8\xF9\x5A\x58\xF9\x24\x03\x0C\x74\x79\x38"
"\x9D\x27\x5E\x63\xD5\x96\x2C\x48\x84\x5D\x7F\xE7\x4A\x75\x7C\xC4"
"\x45\x80\xE4\x50\xC5\x48\x31\xC1\xBB\xA1\xB3\x96\x5A\xCD\x55\x5D"
"\x63\x11\xD5\x20\xD1\x21\xAB\xC6\xAE\x80\x00\xB1\x86\x8C\xEF\x97"
"\x46\xA3\xD4\x0D\xBA\x40\xDF\x1F\x57\x6C\x08\x64\xE5\x36\xDD\x83"
"\x22\x0E\x7F\xAF\xF8\xA5\xEF\xFE"
;

*/

// 45 41 04-05: from orig skype55

char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\xA6\x60\x57\xB4\xC5\x2B\x48\x0C"
"\xBA\xF6\x0D\x1F\x60\xCD\xFD\x53\xCA\x42\x40\x54\x47\x73\x03\xDD"
"\x7D\xE9\x9B\x76\x40\xA5\x34\x7E\xE0\x72\x23\x7D\x21\x4A\x68\x10"
"\xE3\xD6\x78\x2D\xDB\x3E\xFB\xDA\x71\xE9\x13\x8D\xF1\xDC\x9B\x04"
"\x03\x00\x8F\x4F\x04\xA5\x44\xBE\x33\xFD\xF1\xE9\xB3\xC1\xBB\xB7"
"\xDE\x08\x58\xD1\x98\x24\x30\xFA\x50\xE8\x91\xAE\xC5\xD0\x20\xDA"
"\x8D\x54\x3C\xEB\xC7\x8F\x16\x22\x4D\xE8\x59\xCB\xEB\xED\x56\xA2"
"\xCE\xDF\xD2\xA6\xB6\xA4\xAB\xCA\x36\x00\x4C\x85\xDB\xE4\x44\x6A"
"\x6A\xD7\x19\x7B\xA5\x33\xF4\x03\xAC\x0C\x68\x81\x51\xFC\xAF\x47"
"\x8B\x5A\x18\x78\x76\x04\xF4\xA5\xD9\x49\x96\x6A\x96\x0E\x8B\xE2"
"\xAB\xF6\xE7\xF2\x3D\xF7\x7B\x11\x82\xBD\x77\x85\xF8\x6D\xDF\xC6"
"\xBA\x9F\xE7\xF3\x6C\x4F\x23\xFB\x76\x6E\xE8\x12\x37\x32\x67\xC2"
"\x92\xC0\x45\x67\x90\xAB\x22\x96\x32\xC2\xFB\x64\x5E\x9D\x7F\x52"
"\x23\x94\x03\xDB\x42\xC1\x55\x83\xF6\x59\xDF\xDF\x6A\x3E\x57\x27"
"\x48\x92\xD4\xBC\xCA\x62\x3E\x46\x68\x02\xBF\x93\x9E\xB3\x2E\xA9"
"\xC9\x06\xE7\x60\xC2\x0B\x33\x40\x45\xAD\x81\x37\x1C\x63\x96\xD2"
"\x45\x7C\x77\xDF\xDF\x41\x85\x61\x9F\x82\x0F\x4C\xA9\x52\x5F\x61"
"\x7F\xEB\xF5\x02\x4F\xE0\x40\xF7\x1C\x0F\xCE\x38\x16\x88\xEE\xBD"
"\x97\xBF\xD9\xFD\xE3\x2E\x4E\xC5\x30\x21\xC3\xDD\x56\xBF\x7C\x43"
"\x0B\x00\xC5\xBF\xC1\x82\x16\xEE\x8E\x20\xC6\x52\xA6\xFA\x50\xFC"
"\x77\xE6\x83\xC3\xD8\xA3\xB7\x6F\xE2\x38\x51\x47\x18\x79\x75\x52"
"\x38\x75\x85\xC1\x4B\xAA\x03\x7D\x59\xE3\x1E\x88\xB1\x8A\xBA\x8D"
"\x02\x11\x6E\xE8\xFC\x38\xD3\x8C\x96\xDD\x97\xD9\x77\xD8\x60\x78"
"\x64\x6F\x25\x67\x8F\x2D\x82\x49\x7F\x4C\xA8\x9C\x40\x70\xD3\x44"
"\x78\x57\x69\x0F\x43\xC4\xA1\x3B"
;





int show_memory(char *mem, int len, char *text){
	int zz;
	int i;
	int k;
	char b[16+1];
	int t;

	printf("%s\n",text);
	printf("Len: 0x%08X\n",len);

	zz=0;
	k=0;
	b[16]=0;
	for(i=0;i<len;i++){
		printf("%02X ",mem[i] & 0xff);
		t=mem[i] & 0xff;
		if ((t>=0x20) && (t<=0x7f)){
			memcpy(b+k,mem+i,1);
		}else{
			memcpy(b+k,"\x20",1);
		};
		zz++;
		k++;
		if (zz == 16) { 
			zz=0;
			k=0;
            printf(" ; %s",b);
			printf("\n ");

		};
	};
	printf("\n");

	return 0;
};




int rsa_unsign_profile(char *buf, int len, char *outbuf) {  

    big e,m,kn;
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);

    bytes_to_big(0x100,buf,m);
	bytes_to_big(0x100,skype_pub,kn);

	power(m,65537,kn,e);
	
	big_to_bytes (0x100, e, outbuf, TRUE);

    return 0;
}


int rsa_unsign_profile_data(char *buf, int len, char *outbuf) {  

    big e,m,kn;
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);

    bytes_to_big(0x80,buf,m);
	bytes_to_big(0x80,user_pubkey,kn);

	power(m,65537,kn,e);
	
	big_to_bytes (0x80, e, outbuf, TRUE);

    return 0;
}



int decode_profile(){
	unsigned char outbuf[0x100];
	int i;

	printf("Unsigning first 0x100 bytes...\n");
	rsa_unsign_profile(remote_profile+8,0x100,outbuf);
	show_memory(outbuf,0x100,"unsign cred:");


	for(i=0;i<0x100;i++){
		if((outbuf[i]==0x80) && (outbuf[i+1]==0x01)){
			memcpy(user_pubkey,outbuf+i+2,0x80);
		};
	};
	show_memory(user_pubkey,0x80,"user pubkey data:");

	main_unpack(outbuf, 0x100);

	printf("Unsigning second 0x80 bytes...\n");
	rsa_unsign_profile_data(remote_profile+8+0x100,0x80,outbuf);
	show_memory(outbuf,0x80,"unsign data:");

	return 0;
};






int main(int argc, char* argv[]) {
	
	decode_profile();

	printf("OK\n");

	return 0;
}

